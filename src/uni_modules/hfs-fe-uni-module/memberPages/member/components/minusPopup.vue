<template>
  <u-popup :show="props.show" :mode="props.mode" :overlay="props.overlay" :overlay-opacity="props.overlayOpacity" bg-color="transparent" @open="svgaRender">
    <view class="minus-popup">
      <l-svga ref="svga" />
    </view>
  </u-popup>
</template>

<script setup lang="ts">
const props = withDefaults(defineProps<{
  show: boolean
  mode: string
  overlay: boolean
  overlayOpacity: number
  minus: number
  discount: string
  old: boolean
  card: string
}>(), {
  show: false,
  mode: 'center',
  overlay: true,
  overlayOpacity: 0.5,
  minus: 0,
  discount: '',
  old: false,
  card: '',
})
const emits = defineEmits(['update:show', 'finished'])
const svga: any = ref(null)
const resourceUrl = 'https://fe-resource.haofenshu.com/member/'
const minusFont = 'data:font/ttf;charset=utf-8;base64,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TGs3MmNHOVMhIVIrZ3zlCB0kKR0fLhMdPAEBIAsrJyIhUAAAAAIAJ///AiQC/gATACMAABI2MzIeARUUBwMjNwYjIi4BNTQ3FxQWMzI2PwE2NTQmIyIGBz1/c0dvPxN0ukwkMjNRLgSdKiEhKQ0HCiokKjUFAn9/OWxMO0P+cO8ONWRFECYlLDcaHxceHiw6Qj0AAAAAAC8COgABAAAAAAAAADwAegABAAAAAAABAA0A0wABAAAAAAACAAcA8QABAAAAAAADACABOwABAAAAAAAEABUBiAABAAAAAAAFAA0BugABAAAAAAAGABUB9AABAAAAAAAHAAECFgABAAAAAAAIAAYCJgABAAAAAAALAA4CSwABAAAAAAANAJADfAABAAAAAAAOABgEPwABAAAAAAAQAA0EdAABAAAAAAARAAcEkgADAAEEBAABAA4EmgADAAEEBAACAA4EqgADAAEEBAAEABQEugADAAEEBAAQAA4E0AADAAEEBAARAAQE4AADAAEECQAAAHgAAAADAAEECQABABoAtwADAAEECQACAA4A4QADAAEECQADAEAA+QADAAEECQAEACoBXAADAAEECQAFABoBngADAAEECQAGACoByAADAAEECQAHAAoCCgADAAEECQAIAAwCGAADAAEECQALABwCLQADAAEECQANASACWgADAAEECQAOADAEDQADAAEECQAQABoEWAADAAEECQARAA4EggADAAEIBAAAACoE5gADAAEIBAABAA4FEgADAAEIBAACAA4FIgADAAEIBAAEABQFMgADAAEIBAAHAAoFSAADAAEIBAAIAAgFVAADAAEIBAANAEAFXgADAAEIBAAQAA4FoAADAAEIBAARAAQFsAADAAEMBAABAA4FtgADAAEMBAACAA4FxgADAAEMBAAEABQF1gADAAEMBAAQAA4F7AADAAEMBAARAAQF/AAoAGMAKQAgAEMAbwBwAHkAcgBpAGcAaAB0ACAAUwBoAGUAbgB6AGgAZQBuACAAWQBpAFAAaQBuACAASQBuAGYAbwByAG0AYQB0AGkAbwBuACAAVABlAGMAaABuAG8AbABvAGcAeQAgAEMAbwAuACwAIABMAHQAZAAAKGMpIENvcHlyaWdodCBTaGVuemhlbiBZaVBpbiBJbmZvcm1hdGlvbiBUZWNobm9sb2d5IENvLiwgTHRk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'
async function svgaRender() {
  await uni.loadFontFace({ family: 'minusFont', source: `url("${minusFont}")` })
  svga.value.render(async (parser: any, player: any) => {
    try {
      const videoItem = await parser.load(`${resourceUrl}${props.card}.svga`)
      await player.setVideoItem(videoItem)
      props.old && player.setImage(`${resourceUrl}old_user.png`, 'laoyonghu_6E498E98-3DB9-426D-809D-0E735CF870FC')
      // #ifdef H5
      player.setText({ text: props.discount, color: '#FFFFFF', size: `${uni.upx2px(104)}px`, family: 'minusFont', offset: { x: 0, y: 2 } }, 'zhekou_80C2A658-1163-4527-A275-6056A97E0F16')
      player.setText({ text: props.minus, color: '#FF381B', size: `${uni.upx2px(96)}px`, family: 'minusFont', offset: { x: 0, y: 2 } }, 'jiage_8681167D-7B14-4FC3-8BFC-A2B4E0B13E8A')
      // #endif
      // #ifdef MP-WEIXIN
      player.setText({ text: props.discount, color: '#FFFFFF', size: uni.upx2px(104), family: 'minusFont', offset: { x: 0, y: 20 } }, 'zhekou_80C2A658-1163-4527-A275-6056A97E0F16')
      player.setText({ text: props.minus, color: '#FF381B', size: uni.upx2px(96), family: 'minusFont', offset: { x: 0, y: 15 } }, 'jiage_8681167D-7B14-4FC3-8BFC-A2B4E0B13E8A')
      // #endif
      player.loops = 1
      player.startAnimation()
      player.onFinished(() => {
        emits('update:show', false)
        emits('finished')
      })
    }
    // eslint-disable-next-line unused-imports/no-unused-vars
    catch (e) {
      emits('update:show', false)
      emits('finished')
    }
  })
}
</script>

<style lang="scss" scoped>
.minus-popup {
  width: 750rpx;
  height: 800rpx;
}
</style>
